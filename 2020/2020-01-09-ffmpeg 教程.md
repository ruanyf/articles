# ffmpeg å‘½ä»¤

-   å…è´¹çš„å¼€æºè½¯ä»¶ï¼Œç”¨äºå¤šåª’ä½“ç¼–è¾‘ï¼Œè½¬æ¢...
-   å§‹äº2000å¹´

å®‰è£…ï¼š

- [https://www.ffmpeg.org/download.html](https://www.ffmpeg.org/download.html)

æœ€å¥½ç”¨çš„æ˜¯å‘½ä»¤è¡Œã€‚

## æ¦‚å¿µ

å®¹å™¨ï¼šå®¹å™¨åŒ…å«åª’ä½“æ•°æ®ã€‚å…¸å‹ç¤ºä¾‹ï¼š

MP4ï¼šH.264ï¼ŒH.264ï¼ŒAACéŸ³é¢‘ï¼Œâ€¦çš„MPEG-4 Part 14å®¹å™¨
MKVï¼šé€‚ç”¨äºä»»ä½•åª’ä½“æ ¼å¼çš„å¤šåŠŸèƒ½å®¹å™¨
WebMï¼šMKVçš„å­é›†ï¼ŒWebæµä¸­çš„ç”¨æ³•
AVIï¼šæ—§ç‰ˆå®¹å™¨

æŸ¥çœ‹æ”¯æŒçš„å®¹å™¨ã€‚

```bash
$ ffmpeg -formats
```

CODECï¼šæ”¯æŒçš„ç¼–ç æ ¼å¼ã€‚

æŸ¥çœ‹æ”¯æŒçš„ç¼–ç æ ¼å¼ï¼ŒåŒ…æ‹¬è§†é¢‘å’ŒéŸ³é¢‘ã€‚

```bash
$ ffmpeg -codecs
```

å¸¸ç”¨çš„ç¼–ç æ ¼å¼

Currently mostly used, standardized by ITU/ISO:

- ğŸ¥ H.262 / MPEG-2 Part H: Broadcasting, TV, used for backwards compatibility
- ğŸ¥ H.264 / MPEG-4 Part 10: The de-facto standard for video encoding today
- ğŸ¥ H.265 / HEVC / MPEG-H: Successor of H.264, up to 50% better quality
- ğŸ”Š MP3 / MPEG-2 Audio Layer III: Used to be the de-facto audio coding standard
- ğŸ”Š AAC / ISO/IEC 14496-3:2009: Advanced Audio Coding standard

Competitors that are royalty-free:

- ğŸ¥ VP8: Free, open-source codec from Google (not so much in use anymore)
- ğŸ¥ VP9: Successor to VP8, almost as good as H.265
- ğŸ¥ AV1: A successor to VP9, claims to be better than H.265

ä¸Šé¢è¿™æ ·éƒ½æ˜¯æœ‰æŸçš„ç¼–ç æ ¼å¼ã€‚æ— æŸçš„æ ¼å¼ï¼Œä½“ç§¯è¾ƒå¤§ï¼Œè¿™é‡Œå°±ä¸ä»‹ç»äº†ã€‚

### ENCODERS

ç¼–ç å™¨ï¼šå®é™…ç¼–ç çš„åº“ã€‚

- ğŸ¥ libx264: most popular free and open-source H.264 encoder
- ğŸ¥ NVENC: NVIDIA GPU-based H.264 encoder
- ğŸ¥ libx265: free and open-source HEVC encoder
- ğŸ¥ libvpx: VP8 and VP9 encoder from Google
- ğŸ¥ libaom: AV1 encoder
- ğŸ”Š libfdk-aac: AAC encoder
- ğŸ”Š aac: native FFmpeg AAC encoder

æŸ¥çœ‹æ”¯æŒçš„ç¼–ç å™¨

```bash
$ ffmpeg -encoders
```

## æ ¼å¼

ffmpeg {1} {2} -i {3} {4} {5}, where:

1. global options
2. input file options
3. input url
4. output file options
5. output url

**The parts 2, 3, 4 and 5 can be as many as you need. It's easier to understand this argument format in action:

```bash
$ ffmpeg \
<global-options> \
<input-options> \
-i <input> \
<output-options> \
<output>
```

```bash
# WARNING: this file is around 300MB
$ wget -O bunny_1080p_60fps.mp4 http://distribution.bbb3d.renderfarming.net/video/mp4/bbb_sunflower_1080p_60fps_normal.mp4

$ ffmpeg \
-y \ # global options
-c:a libfdk_aac -c:v libx264 \ # input options
-i bunny_1080p_60fps.mp4 \ # input url
-c:v libvpx-vp9 -c:a libvorbis \ # output options
bunny_1080p_60fps_vp9.webm # output url**
```

This command takes an input file mp4 containing two streams (an audio encoded with aac CODEC and a video encoded using h264 CODEC) and convert it to webm, changing its audio and video CODECs too.

FFmpeg will adopt or guess the default values for you. For instance when you just type ffmpeg -i input.avi output.mp4 what audio/video CODEC does it use to produce the output.mp4?

```bash
$ ffmpeg -i input.avi output.mp4
```

webmã€mp4 éƒ½æ˜¯å®¹å™¨æ ¼å¼ã€‚

## ç”¨æ³•

```bash
$ ffmpeg -i input.mp4 output.avi
```

### Transcoding

è½¬æ¢ç¼–ç æ ¼å¼  (e.g. H.264 using libx264)

ffmpeg -i <input> -c:v libx264 output.mp4

è§†é¢‘æ ¼å¼ï¼ˆtranscodingï¼‰ï¼šH264(AVC) è½¬ H265(HEVC)

```bash
$ ffmpeg \
-i bunny_1080p_60fps.mp4 \
-c:v libx265 \
bunny_1080p_60fps_h265.mp4
```

- `-c` sets the encoder (see ffmpeg -encoders)
- `-c copy` only copies bitstream
- `-c:v` sets only video encoders
- `-c:a` sets only audio encoders
- `-an` and `-vn` would disable audio or video streams
- `-preset`ï¼šè¾“å‡ºçš„è§†é¢‘è´¨é‡ï¼Œæœ‰ä»¥ä¸‹å‡ ä¸ªå€¼ ultrafast, superfast, veryfast, faster, fast, medium, slow, slower, veryslowã€‚

### Transmuxing

ä»ä¸€ç§å®¹å™¨è½¬åˆ°å¦ä¸€ç§å®¹å™¨ã€‚

å®¹å™¨æ ¼å¼ï¼ˆtransmuxingï¼‰ï¼šmp4 è½¬ webm

ä¸‹é¢æ˜¯ä¸è½¬æ¢ç¼–ç çš„å†™æ³•ã€‚

```
$ ffmpeg -i input.mp4 -c copy output.mkv
```

è½¬æ¢ç¼–ç ã€‚

```bash
$ ffmpeg \
-i bunny_1080p_60fps.mp4 \
-c copy \ # just saying to ffmpeg to skip encoding
bunny_1080p_60fps.webm
```

è§†é¢‘çš„ç ç‡ï¼ˆtransratingï¼‰ï¼šproducing a rendition with bit rate between 3856K and 2000K.

```
$ ffmpeg \
-i bunny_1080p_60fps.mp4 \
-minrate 964K -maxrate 3856K -bufsize 2000K \
bunny_1080p_60fps_transrating_964_3856.mp4
```

æ”¹å˜è§†é¢‘åˆ†è¾¨ç‡ï¼ˆtranssizingï¼‰ï¼šconverting a 1080p to a 480p resolution.

```bash
$ ffmpeg \
-i bunny_1080p_60fps.mp4 \
-vf scale=480:-1 \
bunny_1080p_60fps_transsizing_480.mp4
```

ä»è§†é¢‘é‡Œé¢æå–éŸ³é¢‘ï¼ˆdemuxingï¼‰ï¼šExtracting  `audio`  from  `container`:

```bash
$ ffmpeg \
-i small_bunny_1080p_30fps.mp4 \
-vn -c:a copy \
small_bunny_audio.aac
```

éŸ³é¢‘åŠ å…¥è§†é¢‘ï¼ˆMuxingï¼‰

```bash
$ ffmpeg \
-i small_bunny_audio.aac -i small_bunny_1080p_30fps.mp4 \ small_bunny_1080p_30fps_muxed.mp4
```

### æˆªå›¾

æˆªå›¾ï¼šGet images from 1s video:

```bash
$ ffmpeg \
-y \
-i /files/v/bunny_1080p_30fps.mp4 \
-ss 00:01:24 -t 00:00:01 \
smallest_bunny_1080p_30fps_%3d.jpg

$ ffmpeg \
-ss 01:23:45 \
-i input \
-vframes 1 -q:v 2 \
output.jpg
```

ä¸Šé¢ä»£ç ä¸­ï¼Œ`-vframes 1`æŒ‡å®šåªæˆªå–ä¸€å¸§ï¼Œ`-q:v 2`è¡¨ç¤ºè¾“å‡ºçš„å›¾ç‰‡è´¨é‡ï¼Œ`2`è¡¨ç¤ºè¾ƒé«˜çš„è´¨é‡ã€‚

### è£å‰ªï¼ˆSEEKING AND CUTTINGï¼‰

Cut a video from timestamp <start> for <duration>, or until <end>:

```bash
ffmpeg -ss <start> -i <input> -t <duration> -c copy <output>
ffmpeg -ss <start> -i <input> -to <end> -c copy <output>
```

Examples:

```bash
ffmpeg -ss 00:01:50 -i <input> -t 10.5 -c copy <output>
ffmpeg -ss 2.5 -i <input> -to 10 -c copy <output>
```

## å‚è€ƒé“¾æ¥

- [FFmpeg libav tutorial](https://github.com/leandromoreira/ffmpeg-libav-tutorial#chapter-3---transcoding)
- [Digital video introduction](https://github.com/leandromoreira/digital_video_introduction/blob/master/encoding_pratical_examples.md#split-and-merge-smoothly)
- [FFmpeg encoding and editing course](http://slhck.info/ffmpeg-encoding-course/)
- 
